{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "allOf": [{ "$ref": "#/$defs/Table" }],
  "$defs": {
    "Table": {
      "type": "object",
      "properties": {
        "required": { "$ref": "#/$defs/Required" },
        "properties": { "$ref": "#/$defs/Properties" },
        "missingValues": { "$ref": "#/$defs/MissingValues" },
        "missingLabels": { "$ref": "#/$defs/MissingLabels" },
        "primaryKey": { "$ref": "#/$defs/PrimaryKey" },
        "uniqueKeys": { "$ref": "#/$defs/UniqueKeys" },
        "foreignKeys": { "$ref": "#/$defs/ForeignKeys" }
      }
    },
    "Required": {
      "type": "array",
      "items": { "type": "string" }
    },
    "Properties": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/Column"
      }
    },
    "Column": {
      "additionalProperties": false,
      "allOf": [
        {
          "if": { "properties": { "type": { "const": "integer" } } },
          "then": { "$ref": "#/$defs/ColumnTypeInteger" }
        },
        {
          "if": { "properties": { "type": { "const": "number" } } },
          "then": { "$ref": "#/$defs/ColumnTypeNumber" }
        },
        {
          "if": { "properties": { "type": { "const": "boolean" } } },
          "then": { "$ref": "#/$defs/ColumnTypeBoolean" }
        },
        {
          "if": { "properties": { "type": { "const": "string" } } },
          "then": { "$ref": "#/$defs/ColumnTypeString" }
        },
        {
          "if": { "properties": { "type": { "const": "array" } } },
          "then": { "$ref": "#/$defs/ColumnTypeArray" }
        },
        {
          "if": { "properties": { "type": { "const": "object" } } },
          "then": { "$ref": "#/$defs/ColumnTypeObject" }
        }
      ]
    },
    "ColumnTypeString": {
      "allOf": [
        {
          "if": { "not": { "required": ["format"] } },
          "then": { "$ref": "#/$defs/StringColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "list" } } },
          "then": { "$ref": "#/$defs/ListColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "hex" } } },
          "then": { "$ref": "#/$defs/HexColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "base64" } } },
          "then": { "$ref": "#/$defs/Base64Column" }
        },
        {
          "if": { "properties": { "format": { "const": "email" } } },
          "then": { "$ref": "#/$defs/EmailColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "uuid" } } },
          "then": { "$ref": "#/$defs/UuidColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "url" } } },
          "then": { "$ref": "#/$defs/UrlColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "date-time" } } },
          "then": { "$ref": "#/$defs/DateTimeColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "date" } } },
          "then": { "$ref": "#/$defs/DateColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "time" } } },
          "then": { "$ref": "#/$defs/TimeColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "duration" } } },
          "then": { "$ref": "#/$defs/DurationColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "wkt" } } },
          "then": { "$ref": "#/$defs/WktColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "wkb" } } },
          "then": { "$ref": "#/$defs/WkbColumn" }
        }
      ]
    },
    "ColumnTypeInteger": {
      "allOf": [
        {
          "if": { "not": { "required": ["format"] } },
          "then": { "$ref": "#/$defs/IntegerColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "year" } } },
          "then": { "$ref": "#/$defs/YearColumn" }
        }
      ]
    },
    "ColumnTypeNumber": {
      "additionalProperties": false,
      "allOf": [
        {
          "if": { "not": { "required": ["format"] } },
          "then": { "$ref": "#/$defs/NumberColumn" }
        }
      ]
    },
    "ColumnTypeBoolean": {
      "allOf": [
        {
          "if": { "not": { "required": ["format"] } },
          "then": { "$ref": "#/$defs/BooleanColumn" }
        }
      ]
    },
    "ColumnTypeArray": {
      "allOf": [
        {
          "if": { "not": { "required": ["format"] } },
          "then": { "$ref": "#/$defs/ArrayColumn" }
        }
      ]
    },
    "ColumnTypeObject": {
      "allOf": [
        {
          "if": { "not": { "required": ["format"] } },
          "then": { "$ref": "#/$defs/ObjectColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "geojson" } } },
          "then": { "$ref": "#/$defs/GeojsonColumn" }
        },
        {
          "if": { "properties": { "format": { "const": "topojson" } } },
          "then": { "$ref": "#/$defs/TopojsonColumn" }
        }
      ]
    },
    "BaseColumn": {
      "type": "object",
      "properties": {
        "title": { "$ref": "#/$defs/Title" },
        "description": { "$ref": "#/$defs/Description" },
        "missingValues": { "$ref": "#/$defs/MissingValues" },
        "missingLabels": { "$ref": "#/$defs/MissingLabels" }
      }
    },
    "BaseStringColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseColumn" },
        {
          "properties": {
            "type": { "const": "string" },
            "enum": { "$ref": "#/$defs/StringEnum" },
            "pattern": { "$ref": "#/$defs/Pattern" }
          }
        }
      ]
    },
    "BaseIntegerColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseColumn" },
        {
          "properties": {
            "type": { "const": "integer" },
            "enum": { "$ref": "#/$defs/IntegerEnum" },
            "minimum": { "$ref": "#/$defs/IntegerMinimum" },
            "maximum": { "$ref": "#/$defs/IntegerMaximum" },
            "exclusiveMinimum": { "$ref": "#/$defs/IntegerExclusiveMinimum" },
            "exclusiveMaximum": { "$ref": "#/$defs/IntegerExclusiveMaximum" },
            "multipleOf": { "$ref": "#/$defs/IntegerMultipleOf" }
          }
        }
      ]
    },
    "BaseNumberColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseColumn" },
        {
          "properties": {
            "type": { "const": "number" },
            "enum": { "$ref": "#/$defs/NumberEnum" },
            "minimum": { "$ref": "#/$defs/NumberMinimum" },
            "maximum": { "$ref": "#/$defs/NumberMaximum" },
            "exclusiveMinimum": { "$ref": "#/$defs/NumberExclusiveMinimum" },
            "exclusiveMaximum": { "$ref": "#/$defs/NumberExclusiveMaximum" },
            "multipleOf": { "$ref": "#/$defs/NumberMultipleOf" }
          }
        }
      ]
    },
    "BaseBooleanColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseColumn" },
        {
          "properties": {
            "type": { "const": "boolean" },
            "enum": { "$ref": "#/$defs/BooleanEnum" },
            "trueValues": { "$ref": "#/$defs/TrueValues" },
            "falseValues": { "$ref": "#/$defs/FalseValues" }
          }
        }
      ]
    },
    "BaseObjectColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseColumn" },
        { "type": "object" },
        { "$ref": "https://json-schema.org/draft/2020-12/schema" }
      ]
    },
    "BaseArrayColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseColumn" },
        { "type": "array" },
        { "$ref": "https://json-schema.org/draft/2020-12/schema" }
      ]
    },
    "StringColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "minLength": { "$ref": "#/$defs/MinLength" },
            "maxLength": { "$ref": "#/$defs/MaxLength" }
          }
        }
      ]
    },
    "ListColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "format": { "const": "list" },
            "itemType": { "$ref": "#/$defs/ListItemType" },
            "delimiter": { "$ref": "#/$defs/ListDelimiter" }
          }
        }
      ]
    },
    "Base64Column": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "format": { "const": "base64" }
          }
        }
      ]
    },
    "HexColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "format": { "const": "hex" }
          }
        }
      ]
    },
    "EmailColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "format": { "const": "email" }
          }
        }
      ]
    },
    "UuidColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "format": { "const": "uuid" }
          }
        }
      ]
    },
    "UrlColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "format": { "const": "url" }
          }
        }
      ]
    },
    "DatetimeColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "format": { "const": "date-time" },
            "temporalFormat": { "$ref": "#/$defs/TemporalFormat" }
          }
        }
      ]
    },
    "DateColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "format": { "const": "date" },
            "temporalFormat": { "$ref": "#/$defs/TemporalFormat" }
          }
        }
      ]
    },
    "TimeColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "format": { "const": "time" },
            "temporalFormat": { "$ref": "#/$defs/TemporalFormat" }
          }
        }
      ]
    },
    "DurationColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "format": { "const": "duration" }
          }
        }
      ]
    },
    "WktColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "format": { "const": "wkt" }
          }
        }
      ]
    },
    "WkbColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseStringColumn" },
        {
          "properties": {
            "format": { "const": "wkb" }
          }
        }
      ]
    },
    "IntegerColumn": {
      "additionalProperties": false,
      "allOf": [
        { "$ref": "#/$defs/BaseIntegerColumn" },
        {
          "properties": {
            "groupChar": { "$ref": "#/$defs/GroupChar" },
            "withText": { "type": "boolean" }
          }
        }
      ]
    },
    "YearColumn": {
      "additionalProperties": false,
      "allOf": [
        { "$ref": "#/$defs/BaseIntegerColumn" },
        {
          "properties": {
            "format": { "const": "year" }
          }
        }
      ]
    },
    "NumberColumn": {
      "additionalProperties": false,
      "allOf": [
        { "$ref": "#/$defs/BaseNumberColumn" },
        {
          "properties": {
            "decimalChar": { "$ref": "#/$defs/DecimalChar" },
            "groupChar": { "$ref": "#/$defs/GroupChar" },
            "withText": { "type": "boolean" }
          }
        }
      ]
    },
    "BooleanColumn": {
      "additionalProperties": false,
      "allOf": [{ "$ref": "#/$defs/BaseBooleanColumn" }]
    },
    "ArrayColumn": {
      "allOf": [{ "$ref": "#/$defs/BaseArrayColumn" }]
    },
    "ObjectColumn": {
      "allOf": [{ "$ref": "#/$defs/BaseObjectColumn" }]
    },
    "GeojsonColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseObjectColumn" },
        {
          "properties": {
            "format": { "const": "geojson" }
          }
        }
      ]
    },
    "TopojsonColumn": {
      "allOf": [
        { "$ref": "#/$defs/BaseObjectColumn" },
        {
          "properties": {
            "format": { "const": "topojson" }
          }
        }
      ]
    },
    "Title": {
      "type": "string"
    },
    "Description": {
      "type": "string"
    },
    "MissingValues": {
      "type": "array",
      "items": { "type": "string" }
    },
    "MissingLabels": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      }
    },
    "Pattern": {
      "type": "string",
      "format": "regex"
    },
    "MinLength": {
      "type": "integer",
      "minimum": 0
    },
    "MaxLength": {
      "type": "integer",
      "minimum": 0
    },
    "TrueValues": {
      "type": "array",
      "items": { "type": "string" }
    },
    "FalseValues": {
      "type": "array",
      "items": { "type": "string" }
    },
    "IntegerMinimum": {
      "type": "integer"
    },
    "IntegerMaximum": {
      "type": "integer"
    },
    "IntegerExclusiveMinimum": {
      "type": "integer"
    },
    "IntegerExclusiveMaximum": {
      "type": "integer"
    },
    "IntegerMultipleOf": {
      "type": "integer",
      "minimum": 1
    },
    "NumberMinimum": {
      "type": "number"
    },
    "NumberMaximum": {
      "type": "number"
    },
    "NumberExclusiveMinimum": {
      "type": "number"
    },
    "NumberExclusiveMaximum": {
      "type": "number"
    },
    "NumberMultipleOf": {
      "type": "number",
      "exclusiveMinimum": 0
    },
    "DecimalChar": {
      "type": "string",
      "maxLength": 1
    },
    "GroupChar": {
      "type": "string",
      "maxLength": 1
    },
    "TemporalFormat": {
      "type": "string"
    },
    "ListDelimiter": {
      "type": "string",
      "maxLength": 1
    },
    "ListItemType": {
      "enum": [
        "string",
        "integer",
        "number",
        "boolean",
        "datetime",
        "date",
        "time"
      ]
    },
    "IntegerEnum": {
      "type": "array",
      "items": { "type": "integer" }
    },
    "NumberEnum": {
      "type": "array",
      "items": { "type": "number" }
    },
    "BooleanEnum": {
      "type": "array",
      "items": { "type": "boolean" }
    },
    "StringEnum": {
      "type": "array",
      "items": { "type": "string" }
    },
    "PrimaryKey": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1
    },
    "UniqueKeys": {
      "type": "array",
      "items": { "$ref": "#/$defs/UniqueKey" },
      "minItems": 1
    },
    "UniqueKey": {
      "type": "array",
      "items": { "type": "string" },
      "minItems": 1
    },
    "ForeignKeys": {
      "type": "array",
      "items": { "$ref": "#/$defs/ForeignKey" },
      "minItems": 1
    },
    "ForeignKey": {
      "type": "object",
      "required": ["columns", "reference"],
      "properties": {
        "columns": { "$ref": "#/$defs/ForeignKeyColumns" },
        "reference": { "$ref": "#/$defs/ForeignKeyReference" }
      }
    },
    "ForeignKeyReference": {
      "type": "object",
      "required": ["columns"],
      "properties": {
        "resource": { "type": "string" },
        "columns": { "$ref": "#/$defs/ForeignKeyColumns" }
      }
    },
    "ForeignKeyColumns": {
      "type": "array",
      "items": { "type": "string" }
    },
    "IntegerCategoricalValues": {
      "type": "array",
      "items": { "type": "integer" }
    },
    "StringCategoricalValues": {
      "type": "array",
      "items": { "type": "string" }
    },
    "CategoricalLabels": {
      "type": "array",
      "items": { "type": "string" }
    }
  }
}
